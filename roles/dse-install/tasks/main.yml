- name: installing datastax enterprise
  apt: pkg=dse-full={{ dse.packageVersion }} state=installed

- name: creating jna symlink
  shell: ln -s /usr/share/java/jna.jar /usr/share/dse/cassandra/lib || true

- name: configuring datastax enterprise
  template: src=cassandra.yaml dest=/etc/dse/cassandra/cassandra.yaml

#- name: Adding customized cassandra setting
#  template: src=cassandra-env.sh dest=/etc/dse/cassandra/cassandra-env.sh

- name: Put dse script and enable HADOOP for hive
  template: src=dse.sh dest=/etc/default/dse

- name: Put DSE-bundled spark conf
  template: src=spark-env.sh dest=/etc/dse/spark/spark-env.sh

- name: starting dse
  service: name=dse enabled=yes state=started

- name: installing datastax opsCenter agent
  apt: pkg=datastax-agent={{ opsAgent.packageVersion }} state=installed
  notify:
       - restart dse-agent